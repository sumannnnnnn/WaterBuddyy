<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - WaterBuddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body class="min-h-screen flex flex-col">
    <!-- Water wave background -->
    <div class="water-wave"></div>
    <div class="parallax-bg"></div>
    
    <!-- Navigation Bar -->
    <nav class="navbar-glass sticky top-0 z-50 w-full px-4 py-2 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-water text-blue-400 text-2xl neon-accent"></i>
                <span class="text-xl font-bold text-blue-300 neon-accent">WaterBuddy</span>
            </div>
            <div class="flex items-center space-x-6">
                <a href="{{ url_for('dashboard') }}" class="font-medium text-gray-300 hover:text-blue-200 transition-colors">Dashboard</a>
                <a href="{{ url_for('insights') }}" class="font-medium text-gray-300 hover:text-blue-200 transition-colors">Insights</a>
                <a href="{{ url_for('settings') }}" class="font-medium text-blue-300 hover:text-blue-200 transition-colors">Settings</a>
                <form action="{{ url_for('logout') }}" method="post">
                    <button type="submit" class="flex items-center space-x-1 text-gray-300 hover:text-blue-200 transition-colors">
                        <span>Logout</span>
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- Page Title -->
        <div class="mb-8 text-center">
            <h1 class="text-2xl font-bold text-blue-300 neon-accent">Settings</h1>
            <p class="text-gray-300">Customize your WaterBuddy experience</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Profile Settings -->
            <div class="card-3d p-6">
                <h2 class="text-xl font-bold mb-4 text-blue-300 neon-accent">Profile Information</h2>
                
                <form action="{{ url_for('profile') }}" method="post" class="space-y-4">
                    <div>
                        <label for="name" class="block text-gray-300 mb-2">Name</label>
                        <input type="text" id="name" name="name" value="{{ user.name }}" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="email" class="block text-gray-300 mb-2">Email (optional)</label>
                        <input type="email" id="email" name="email" value="{{ user.email }}" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="age" class="block text-gray-300 mb-2">Age</label>
                        <input type="number" id="age" name="age" value="{{ user.age }}" min="1" max="120" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="weight" class="block text-gray-300 mb-2">Weight (kg)</label>
                        <input type="number" id="weight" name="weight" value="{{ user.weight }}" min="20" max="300" step="0.1" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="height" class="block text-gray-300 mb-2">Height (cm)</label>
                        <input type="number" id="height" name="height" value="{{ user.height }}" min="50" max="250" step="0.1" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="profession" class="block text-gray-300 mb-2">Profession</label>
                        <input type="text" id="profession" name="profession" value="{{ user.profession }}" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <button type="submit" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition-colors">
                        Save Profile
                    </button>
                </form>
            </div>
            
            <!-- Reminder Settings -->
            <div class="card-3d p-6">
                <h2 class="text-xl font-bold mb-4 text-blue-300 neon-accent">Hydration Reminders</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="text-white mr-3">Enable Water Reminders</span>
                            <div class="relative">
                                <input type="checkbox" id="toggleReminders" class="sr-only" {{ 'checked' if reminder.is_enabled else '' }}>
                                <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                            </div>
                        </label>
                        <p class="text-gray-400 mt-1">Receive reminders to drink water every 1.5 hours</p>
                    </div>
                    
                    <div id="intervalContainer" class="{{ 'hidden' if not reminder.is_enabled else '' }}">
                        <label for="reminderInterval" class="block text-gray-300 mb-2">Reminder Interval (minutes)</label>
                        <input type="range" id="reminderInterval" min="30" max="240" step="15" value="{{ reminder.reminder_interval }}" class="w-full py-2 px-3 accent-blue-500">
                        <div class="flex justify-between">
                            <span id="intervalValue" class="text-blue-300 font-medium">{{ reminder.reminder_interval }} minutes</span>
                            <span class="text-gray-400">({{ reminder.reminder_interval / 60 }} hours)</span>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-blue-700/30 rounded-lg border border-blue-600/50">
                        <div class="flex items-start mb-2">
                            <i class="fas fa-info-circle text-blue-400 mt-1 mr-2"></i>
                            <p class="text-gray-200">Water reminders will appear in the chatbot section of your dashboard. Make sure to keep the dashboard page open to receive reminders.</p>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-bell text-blue-400 mt-1 mr-2"></i>
                            <p class="text-gray-200">You can also enable browser notifications to get alerted even when the tab is not active.</p>
                        </div>
                    </div>
                    
                    <button id="testReminder" class="py-2 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition-colors w-full">
                        Test Reminder
                    </button>
                </div>
            </div>
            
            <!-- AI Settings -->
            <div class="card-3d p-6 mt-6 md:mt-0 md:col-span-2">
                <h2 class="text-xl font-bold mb-4 text-blue-300 neon-accent">AI Assistant Configuration</h2>
                
                <div class="space-y-6">
                    <div>
                        <div class="flex items-center mb-2">
                            <div class="w-3 h-3 rounded-full mr-2 {{ 'bg-green-500' if session.get('gemini_api_key_set') else 'bg-red-500' }}"></div>
                            <span class="text-white">Google Gemini API Key Status: <span class="font-medium {{ 'text-green-400' if session.get('gemini_api_key_set') else 'text-red-400' }}">{{ 'Configured' if session.get('gemini_api_key_set') else 'Not Set' }}</span></span>
                        </div>
                        <p class="text-gray-400 mb-4">Configure your Gemini API key to enable advanced AI interactions with WaterBuddy. Get your API key from <a href="https://aistudio.google.com/" class="text-blue-400 hover:underline" target="_blank">Google AI Studio</a>.</p>
                        
                        <div class="mb-4">
                            <label for="apiKey" class="block text-gray-300 mb-2">Gemini API Key</label>
                            <input type="password" id="apiKey" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your Gemini API key">
                        </div>
                        
                        <button id="saveApiKey" class="w-full py-2 px-4 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-medium transition-colors">
                            Save API Key
                        </button>
                        
                        <div id="apiKeyMessage" class="mt-3 p-3 rounded-lg bg-gray-800 hidden">
                            <!-- Status messages will appear here -->
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-700">
                        <h3 class="font-medium text-blue-300 mb-2">Test the AI Assistant</h3>
                        <p class="text-gray-400 mb-3">Try a sample query to test the AI assistant with your API key.</p>
                        <a href="{{ url_for('test_gemini') }}" class="inline-block py-2 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition-colors">
                            <i class="fas fa-robot mr-2"></i> Test AI Assistant
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer-glass py-4 px-4 mt-auto">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-gray-400 text-sm">
                &copy; 2025 WaterBuddy. All rights reserved.
            </div>
            <div class="flex space-x-4 text-gray-400">
                <a href="#" class="hover:text-blue-300 transition-colors"><i class="fab fa-twitter"></i></a>
                <a href="#" class="hover:text-blue-300 transition-colors"><i class="fab fa-instagram"></i></a>
                <a href="#" class="hover:text-blue-300 transition-colors"><i class="fab fa-facebook"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Toggle reminders
        const toggleReminders = document.getElementById('toggleReminders');
        const intervalContainer = document.getElementById('intervalContainer');
        
        toggleReminders.addEventListener('change', function() {
            const isEnabled = this.checked;
            
            // Show/hide interval settings
            if (isEnabled) {
                intervalContainer.classList.remove('hidden');
            } else {
                intervalContainer.classList.add('hidden');
            }
            
            // Update in backend
            fetch('/toggle_water_reminders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: isEnabled }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Reminders ' + (data.is_enabled ? 'enabled' : 'disabled'));
            })
            .catch(error => {
                console.error('Error toggling reminders:', error);
            });
        });
        
        // Update reminder interval
        const reminderInterval = document.getElementById('reminderInterval');
        const intervalValue = document.getElementById('intervalValue');
        
        reminderInterval.addEventListener('input', function() {
            intervalValue.textContent = this.value + ' minutes';
        });
        
        reminderInterval.addEventListener('change', function() {
            // Update in backend
            fetch('/set_reminder_interval', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ interval: parseInt(this.value, 10) }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Reminder interval set to ' + data.interval + ' minutes');
            })
            .catch(error => {
                console.error('Error setting reminder interval:', error);
            });
        });
        
        // Toggle button style
        toggleReminders.addEventListener('change', function() {
            const dot = document.querySelector('.dot');
            if (this.checked) {
                dot.classList.add('translate-x-6');
                document.querySelector('.block').classList.add('bg-blue-500');
                document.querySelector('.block').classList.remove('bg-gray-600');
            } else {
                dot.classList.remove('translate-x-6');
                document.querySelector('.block').classList.remove('bg-blue-500');
                document.querySelector('.block').classList.add('bg-gray-600');
            }
        });
        
        // Initialize toggle button visual state
        if (toggleReminders.checked) {
            document.querySelector('.dot').classList.add('translate-x-6');
            document.querySelector('.block').classList.add('bg-blue-500');
            document.querySelector('.block').classList.remove('bg-gray-600');
        }
        
        // Test reminder button
        document.getElementById('testReminder').addEventListener('click', function() {
            // Request notification permission if not granted
            if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // Show a test notification
            if (Notification.permission === 'granted') {
                new Notification('Water Reminder Test', {
                    body: 'This is a test water reminder notification. Keep hydrated!',
                    icon: '/static/images/water-icon.png'
                });
            }
            
            // Alert the user that the test was sent
            alert('A test reminder has been sent! If you enabled browser notifications, you should see one now.');
        });
        
        // API Key handling
        document.getElementById('saveApiKey').addEventListener('click', function() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const messageDiv = document.getElementById('apiKeyMessage');
            
            if (!apiKey) {
                messageDiv.classList.remove('hidden', 'bg-green-800', 'bg-yellow-800');
                messageDiv.classList.add('bg-red-800');
                messageDiv.textContent = 'API key cannot be empty.';
                return;
            }
            
            // Show loading state
            messageDiv.classList.remove('hidden', 'bg-green-800', 'bg-red-800');
            messageDiv.classList.add('bg-yellow-800');
            messageDiv.textContent = 'Saving API key...';
            
            // Save API key
            fetch('/set_gemini_api_key', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ api_key: apiKey }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    messageDiv.classList.remove('bg-yellow-800', 'bg-red-800');
                    messageDiv.classList.add('bg-green-800');
                    messageDiv.textContent = 'API key saved successfully!';
                    
                    // Update the status indicator
                    document.querySelector('.rounded-full').classList.remove('bg-red-500');
                    document.querySelector('.rounded-full').classList.add('bg-green-500');
                    document.querySelector('.font-medium').textContent = 'Configured';
                    document.querySelector('.font-medium').classList.remove('text-red-400');
                    document.querySelector('.font-medium').classList.add('text-green-400');
                } else {
                    messageDiv.classList.remove('bg-yellow-800', 'bg-green-800');
                    messageDiv.classList.add('bg-red-800');
                    messageDiv.textContent = data.message || 'Error saving API key. Please try again.';
                }
            })
            .catch(error => {
                messageDiv.classList.remove('bg-yellow-800', 'bg-green-800');
                messageDiv.classList.add('bg-red-800');
                messageDiv.textContent = 'Error: ' + error.message;
            });
        });
    </script>
</body>
</html> 